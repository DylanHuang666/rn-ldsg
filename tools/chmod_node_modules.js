const path = require('path');
const proccess = require('process');
const fs = require('fs');

function _doChmodBin(p) {
    const files = fs.readdirSync(p);
    if (!files) return;

    for (const f of files) {
        const fp = path.join(p, f);
        fs.chmodSync(fp, 0o777);
        // console.log('chmod:', fp);
    }
}

function _walkBinFolder(f) {
    if (!fs.existsSync(f)) return;

    const files = fs.readdirSync(f);
    if (!files) return;

    for (const t of files) {
        const fp = path.join(f, t);
        const st = fs.statSync(fp);
        if (st.isDirectory()) {
            if ('.bin' == t) {
                _doChmodBin(fp);
                continue;
            }

            _walkBinFolder(fp);
            continue;
        }
        
        //文件
        const extName= path.extname(t);
        if (
            '.sh' == extName
            || '.command' == extName
        ) {
            fs.chmodSync(fp, 0o777);
            // console.log('chmod:', fp);
        }
    }
}

function main() {
    const node_modules_path = proccess.argv[2];
    // console.log(node_modules_path);
    
    _walkBinFolder(node_modules_path);
}

main();