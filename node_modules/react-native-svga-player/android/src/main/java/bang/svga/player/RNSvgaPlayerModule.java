package bang.svga.player;

import com.facebook.react.bridge.Promise;
import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.ReactContextBaseJavaModule;
import com.facebook.react.bridge.ReactMethod;
import com.facebook.react.module.annotations.ReactModule;
import com.opensource.svgaplayer.SVGAParser;

import java.net.URL;

import javax.annotation.Nonnull;

@ReactModule(name = RNSvgaPlayerModule.NAME)
public class RNSvgaPlayerModule extends ReactContextBaseJavaModule {

    static final String NAME = "RNSvgaPlayer";

    public RNSvgaPlayerModule(@Nonnull ReactApplicationContext reactContext) {
        super(reactContext);
    }


    @Override
    public String getName() {
        return NAME;
    }


    @ReactMethod
    public void prefetch(String url, final Promise promise) {
        try {
            SVGAParser.Companion.prefetch(this.getReactApplicationContext(), new URL(url), new SVGAParser.PrefetchCompletion() {
                @Override
                public void onComplete() {
                    promise.resolve(1);
                }

                @Override
                public void onError() {
                    promise.reject("0", "error");
                }
            });
        } catch (Exception e) {
            promise.reject("0", e.getMessage());
        }
    }

}
