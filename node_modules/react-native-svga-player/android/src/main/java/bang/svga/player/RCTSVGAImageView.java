package bang.svga.player;

import android.content.Context;
import android.util.AttributeSet;

import com.facebook.react.bridge.Arguments;
import com.facebook.react.bridge.ReactContext;
import com.facebook.react.bridge.WritableMap;
import com.facebook.react.uimanager.events.RCTEventEmitter;
import com.opensource.svgaplayer.SVGACallback;
import com.opensource.svgaplayer.SVGAImageView;

public class RCTSVGAImageView extends SVGAImageView {
    protected String currentState;

    public RCTSVGAImageView(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        setCallback(new SVGACallback() {

            @Override
            public void onStep(int frame, double percentage) {
                WritableMap map = Arguments.createMap();
                map.putInt("frame", frame);
                map.putDouble("percentage", percentage);
                sendEvent(EVT_FRAME, map);
            }

            @Override
            public void onRepeat() {
                sendEvent(EVT_REPEAT, null);
            }

            @Override
            public void onPause() {
                sendEvent(EVT_PAUSE, null);
            }

            @Override
            public void onFinished() {
                sendEvent(EVT_FINISHED, null);
            }
        });
    }

    public static final String EVT_FRAME = "onFrame";
    public static final String EVT_REPEAT = "onRepeat";
    public static final String EVT_PAUSE = "onPause";
    public static final String EVT_FINISHED = "onFinished";

    private void sendEvent(String evtName, WritableMap map) {
        ReactContext reactContext = (ReactContext) getContext();
        reactContext.getJSModule(RCTEventEmitter.class).
                receiveEvent(getId(), evtName, map);
    }

}
